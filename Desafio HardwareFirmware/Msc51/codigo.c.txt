/* Main.c file generated by New Project wizard
 *
 * Created:   qui out 24 2024
 * Processor: 80C31
 * Compiler:  SDCC for 8051
 */

#include <mcs51reg.h>

int i = 0, press = 0;
int botao_anterior,botao_atual;

void Timer0_ISR() interrupt 1	// Timer0 interrupt 
{
   ++i; 
   if(i==100 && press>0)
   {   
      --press;
      i=0;
   }
   if(press <= 0)
   {
      TR0 = 0; 
      P1_1 = 0;
   }
   TH0 = 0x3C;      
   TL0 = 0xB0;      
}

void main(void)
 { 
   P0 = 0x01; //Limpar display
   P0 =0x38;
   P0 =0x0e;
   P0 =0x01;
   P0 =0x06;
   P0 =0x0c;
   P0 =0x80;
    
   EA  = 1;         	// Habilitar interrupção
   ET0 = 1;
   TMOD = 0x01;		// Modo 1 = Timer0
   TH0 = 0x3C;		//Para um clock de 12Mhz do cristal, dividido por 12 do microcontrolador, 1MHz -> T = 1ms
   TL0 = 0xB0;      	// Valores para iniciar acontagem e concluir no 65535
   
   P1_1 = 0;
   press = 0;
    
   botao_anterior = botao_atual;
   botao_atual = P1_0; 
    
   while (1)
   {
      P0=0x80;
      botao_anterior = botao_atual;
      botao_atual = P1_0; 
      if(botao_anterior == 1 && botao_atual == 0)
      {
	 if(P1_1==0)
	    P1_1 = 1;
	 ++press;
	 TR0 = 1;  	      	// Começa timer0
      }
   }
 }